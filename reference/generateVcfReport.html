<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>generateVcfReport — generateVcfReport • epialleleR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="generateVcfReport — generateVcfReport" />
<meta property="og:description" content="This function calculates base frequencies at particular genomic positions and
tests their association with the methylation status of the sequencing reads." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epialleleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/epialleleR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/BBCG/epialleleR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>generateVcfReport</h1>
    <small class="dont-index">Source: <a href='https://github.com/BBCG/epialleleR/blob/master/R/generateVcfReport.R'><code>R/generateVcfReport.R</code></a></small>
    <div class="hidden name"><code>generateVcfReport.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calculates base frequencies at particular genomic positions and
tests their association with the methylation status of the sequencing reads.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>generateVcfReport</span><span class='op'>(</span>
  <span class='va'>bam</span>,
  <span class='va'>vcf</span>,
  vcf.style <span class='op'>=</span> <span class='cn'>NULL</span>,
  bed <span class='op'>=</span> <span class='cn'>NULL</span>,
  report.file <span class='op'>=</span> <span class='cn'>NULL</span>,
  zero.based.bed <span class='op'>=</span> <span class='cn'>FALSE</span>,
  threshold.reads <span class='op'>=</span> <span class='cn'>TRUE</span>,
  threshold.context <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CG"</span>, <span class='st'>"CHG"</span>, <span class='st'>"CHH"</span>, <span class='st'>"CxG"</span>, <span class='st'>"CX"</span><span class='op'>)</span>,
  min.context.sites <span class='op'>=</span> <span class='fl'>2</span>,
  min.context.beta <span class='op'>=</span> <span class='fl'>0.5</span>,
  max.outofcontext.beta <span class='op'>=</span> <span class='fl'>0.1</span>,
  min.mapq <span class='op'>=</span> <span class='fl'>0</span>,
  skip.duplicates <span class='op'>=</span> <span class='cn'>FALSE</span>,
  gzip <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>bam</th>
      <td><p>BAM file location string OR preprocessed output of
<code><a href='preprocessBam.html'>preprocessBam</a></code> function.</p></td>
    </tr>
    <tr>
      <th>vcf</th>
      <td><p>Variant Call Format (VCF) file location string OR a VCF object
returned by <code><a href='https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html'>readVcf</a></code> function. If VCF object
is supplied, its seqlevels must match the seqlevels of the BAM file/object
used.</p></td>
    </tr>
    <tr>
      <th>vcf.style</th>
      <td><p>string for the seqlevels style of the VCF file, if
different from BED file/object. Only has effect when `vcf` parameter points
to the VCF file location and `bed` is not NULL. Possible values:</p><ul>
<li><p>NULL (the default) -- seqlevels in BED file/object and VCF file are
  the same</p></li>
<li><p>"NCBI", "UCSC", ... -- valid parameters of
  <code><a href='https://rdrr.io/pkg/GenomeInfoDb/man/seqlevelsStyle.html'>seqlevelsStyle</a></code> function</p></li>
</ul></td>
    </tr>
    <tr>
      <th>bed</th>
      <td><p>Browser Extensible Data (BED) file location string OR object of
class <code>GRanges</code> holding genomic coordinates for
regions of interest. It is used to include only the specific genomic ranges
when the VCF file is loaded. This option has no effect when VCF object is
supplied as a `vcf` parameter. The seqlevels of BED file/object must match
the seqlevels of the BAM file/object used.</p></td>
    </tr>
    <tr>
      <th>report.file</th>
      <td><p>file location string to write the VCF report. If NULL
(the default) then report is returned as a
<code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code> object.</p></td>
    </tr>
    <tr>
      <th>zero.based.bed</th>
      <td><p>boolean defining if BED coordinates are zero based
(default: FALSE).</p></td>
    </tr>
    <tr>
      <th>threshold.reads</th>
      <td><p>boolean defining if sequence reads should be
thresholded before counting bases in reference and variant epialleles
(default: TRUE). Disabling thresholding is possible but makes no sense in
this context as all the reads will be assigned to the variant epiallele,
which will result in Fisher's Exact test p-value of 1 (in columns `FEp+` and
`FEP-`).</p></td>
    </tr>
    <tr>
      <th>threshold.context</th>
      <td><p>string defining cytosine methylation context used
for thresholding the reads:</p><ul>
<li><p>"CG" (the default) -- within-the-context: CpG cytosines (called as
  zZ), out-of-context: all the other cytosines (hHxX)</p></li>
<li><p>"CHG" -- within-the-context: CHG cytosines (xX), out-of-context: hHzZ</p></li>
<li><p>"CHH" -- within-the-context: CHH cytosines (hH), out-of-context: xXzZ</p></li>
<li><p>"CxG" -- within-the-context: CG and CHG cytosines (zZxX),
  out-of-context: CHH cytosines (hH)</p></li>
<li><p>"CX" -- all cytosines are considered within-the-context, this
  effectively results in no thresholding</p></li>
</ul><p>This option has no effect when read thresholding is disabled.</p></td>
    </tr>
    <tr>
      <th>min.context.sites</th>
      <td><p>non-negative integer for minimum number of cytosines
within the `threshold.context` (default: 2). Reads containing <strong>fewer</strong>
within-the-context cytosines are considered completely unmethylated (thus
belonging to the reference epiallele). This option has no effect when read
thresholding is disabled.</p></td>
    </tr>
    <tr>
      <th>min.context.beta</th>
      <td><p>real number in the range [0;1] (default: 0.5). Reads
with average beta value for within-the-context cytosines <strong>below</strong> this
threshold are considered completely unmethylated (thus belonging to the
reference epiallele). This option has no effect when read thresholding is
disabled.</p></td>
    </tr>
    <tr>
      <th>max.outofcontext.beta</th>
      <td><p>real number in the range [0;1] (default: 0.1).
Reads with average beta value for out-of-context cytosines <strong>above</strong>
this threshold are considered completely unmethylated (thus belonging to the
reference epiallele). This option has no effect when read thresholding is
disabled.</p></td>
    </tr>
    <tr>
      <th>min.mapq</th>
      <td><p>non-negative integer threshold for minimum read mapping
quality (default: 0). Option has no effect if preprocessed BAM data was
supplied as an input.</p></td>
    </tr>
    <tr>
      <th>skip.duplicates</th>
      <td><p>boolean defining if duplicate aligned reads should be
skipped (default: FALSE). Option has no effect if preprocessed BAM data was
supplied as an input OR duplicate reads were not marked by alignment
software.</p></td>
    </tr>
    <tr>
      <th>gzip</th>
      <td><p>boolean to compress the report (default: FALSE).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>boolean to report progress and timings (default: TRUE).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code> object containing VCF report or
NULL if report.file was specified. The report columns are:</p><ul>
<li><p>name -- variation identifier (e.g. "rs123456789")</p></li>
<li><p>seqnames -- reference sequence name</p></li>
<li><p>range -- genomic coordinates of the variation</p></li>
<li><p>REF -- base at the reference allele</p></li>
<li><p>ALT -- base at the alternative allele</p></li>
<li><p>[M|U][+|-][Ref|Alt] -- number of <strong>Ref</strong>erence or
  <strong>Alt</strong>ernative bases that were found at this particular position
  within <strong>M</strong>ethylated (above threshold) or <strong>U</strong>nmethylated
  (below threshold) reads that were mapped to <strong>"+"</strong> (forward) or
  <strong>"-"</strong> (reverse) DNA strand. NA values mean that it is not possible
  to determine the number of bases due to the bisulfite conversion-related
  limitations (C-&gt;T variants on "+" and G-&gt;A on "-" strands)</p></li>
<li><p>SumRef -- sum of all <strong>Ref</strong>erence base counts</p></li>
<li><p>SumAlt -- sum of all <strong>Alt</strong>ernative base counts</p></li>
<li><p>FEp+ -- Fisher's Exact test p-value for association of a variation
  with methylation status of the reads that map to the <strong>"+"</strong> (forward)
  DNA strand. Calculated using following contingency table:</p><table class='table'>
<tr><td>M+Ref</td><td>M+Alt</td></tr>
<tr><td>U+Ref</td><td>U+Alt</td></tr>
</table>
</li>
<li><p>FEp- -- Fisher's Exact test p-value for association of a variation
  with methylation status of the reads that map to the <strong>"-"</strong> (reverse)
  DNA strand. Calculated using following contingency table:</p><table class='table'>
<tr><td>M-Ref</td><td>M-Alt</td></tr>
<tr><td>U-Ref</td><td>U-Alt</td></tr>
</table>
</li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Using BAM reads and sequence variation information as an input,
`generateVcfReport` function thresholds the reads (or read pairs as a single
entity) according to supplied parameters and calculates the occurrence of
<strong>Ref</strong>erence and <strong>Alt</strong>ernative bases within reads, taking into
the account DNA strand the read mapped to and average methylation level
(epiallele status) of the read.</p>
<p>The information on sequence variation can be supplied as a Variant Call
Format (VCF) file location or an object of class VCF, returned by the
<code><a href='https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html'>readVcf</a></code> function call. As whole-genome VCF
files can be extremely large, it is strongly advised to use only relevant
subset of their data, prefiltering the VCF object manually before calling
`generateVcfReport` or specifying `bed` parameter when `vcf` points to the
location of such large VCF file. Please note that all the BAM, BED and VCF
files must use the same seqlevels (i.e. chromosome names).</p>
<p>After counting, function checks if certain bases occur more often within
reads belonging to certain epialleles using Fisher's Exact test
(<code><a href='https://rdrr.io/r/stats/fisher.test.html'>fisher.test</a></code>) and reports separate p-values for reads
mapped to <strong>"+"</strong> (forward) and <strong>"-"</strong> (reverse) DNA strands.</p>
<p>Please note that the final report currently includes only the VCF entries
with single-base REF and ALT alleles. Also, there is no filtering by the base
quality at the moment, thus the output of `generateVcfReport` is equivalent
to the one of `samtools mplieup -Q 0 ...`, and may result in false SNVs
caused by misalignments. These will be fixed in the future.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='preprocessBam.html'>preprocessBam</a></code> for preloading BAM data,
<code><a href='generateCytosineReport.html'>generateCytosineReport</a></code> for methylation statistics at the level
of individual cytosines, <code><a href='generateBedReport.html'>generateBedReport</a></code> for genomic
region-based statistics, <code><a href='generateBedEcdf.html'>generateBedEcdf</a></code> for analysing the
distribution of per-read beta values, and `epialleleR` vignettes for the
description of usage and sample data.</p>
<p><code><a href='https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html'>GRanges</a></code> class for working with genomic ranges,
<code><a href='https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html'>readVcf</a></code> function for loading VCF data,
<code><a href='https://rdrr.io/pkg/GenomeInfoDb/man/seqlevelsStyle.html'>seqlevelsStyle</a></code> function for getting or setting
the seqlevels style.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'>  <span class='va'>capture.bam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"capture.bam"</span>, package<span class='op'>=</span><span class='st'>"epialleleR"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>capture.bed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"capture.bed"</span>, package<span class='op'>=</span><span class='st'>"epialleleR"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>capture.vcf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"capture.vcf.gz"</span>,</span>
<span class='r-in'>                             package<span class='op'>=</span><span class='st'>"epialleleR"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># VCF report</span></span>
<span class='r-in'>  <span class='va'>vcf.report</span> <span class='op'>&lt;-</span> <span class='fu'>generateVcfReport</span><span class='op'>(</span>bam<span class='op'>=</span><span class='va'>capture.bam</span>, bed<span class='op'>=</span><span class='va'>capture.bed</span>,</span>
<span class='r-in'>                                  vcf<span class='op'>=</span><span class='va'>capture.vcf</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading BED file</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.017s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading VCF file</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [8.892s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading BAM file</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.139s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Preprocessing BAM data:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Transforming sequences</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.037s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Merging pairs</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.014s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Thresholding reads</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.002s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Extracting base frequences</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [12.175s]</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Oleksii Nikolaienko.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


