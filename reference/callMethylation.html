<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>callMethylation — callMethylation • epialleleR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="callMethylation — callMethylation"><meta property="og:description" content="This function calls cytosine methylation and stores calls in BAM files."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epialleleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/epialleleR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/values.html">The epialleleR output values</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BBCG/epialleleR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>callMethylation</h1>
    <small class="dont-index">Source: <a href="https://github.com/BBCG/epialleleR/blob/HEAD/R/callMethylation.R" class="external-link"><code>R/callMethylation.R</code></a></small>
    <div class="hidden name"><code>callMethylation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calls cytosine methylation and stores calls in BAM files.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">callMethylation</span><span class="op">(</span></span>
<span>  <span class="va">input.bam.file</span>,</span>
<span>  <span class="va">output.bam.file</span>,</span>
<span>  <span class="va">genome</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>input.bam.file</dt>
<dd><p>input BAM file location string.</p></dd>


<dt>output.bam.file</dt>
<dd><p>output BAM file location string.</p></dd>


<dt>genome</dt>
<dd><p>reference (genomic) sequences file location string or an
output of <code><a href="preprocessGenome.html">preprocessGenome</a></code>.</p></dd>


<dt>nthreads</dt>
<dd><p>non-negative integer for the number of additional HTSlib
threads to be used during file decompression (default: 1).</p></dd>


<dt>verbose</dt>
<dd><p>boolean to report progress and timings (default: TRUE).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>list object with simple statistics of processed ("nrecs") records
and calls made ("ncalled"). Even though "ncalled" can be less than "nrecs"
(e.g., because not all reads are mapped), all records from the input BAM are
written to the output BAM.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function makes cytosine methylation calls for input BAM file and writes
them in the XM tag of the output BAM file. Calls are made on the basis of
reference (e.g., genomic) sequence and observed sequence and cytosine context
of reads. Data reading/processing is done by means of HTSlib,
therefore it is possible to significantly (&gt;5x) speed up the calling
using several (4-8) HTSlib decompression threads.</p>
<p>Methylation calling is only possible if genomic strand the read was aligned
to is known. This information is typically stored in XG tag of
Bismark/Illumina BAM files, or in YC tag of BWA-meth alignment files.
`epialleleR` is aware of that and will use the whichever tag is available.</p>
<p>The sequence context of cytosines (h/H for "CHH", x/X for "CHG",
z/Z for "CG") is determined based on the
actual (observed) sequence of the read. E.g., if read "ACGT" was aligned
to the forward strand of reference sequence "ACaaGT" with the CIGAR string
"2M2D2M" (2 bases match,
2 reference bases are deleted, 2 bases match), then methylation call string
will be ".Z.." (in contrast to the reference's one of ".H...."). This
makes cytosine calls nearly identical to ones produced by Bismark Bisulfite
Read Mapper and Methylation Caller or Illumina DRAGEN Bio IT Platform,
however with one important distinction: `epialleleR` reports sequence context
of cytosines followed by unknown bases ("CNN") as "H.." instead of "U.."
(unknown; as for example Illumina DRAGEN Bio IT Platform does). Similarly,
forward strand context of "CNG" is reported as "X..", forward strand context
of "CGN" -&gt; "Z..", reverse strand context of "NNG" -&gt; "..H", reverse strand
context of "CNG" -&gt; "..X", reverse strand context of "NCG" -&gt; "..Z".
Both lowercase and uppercase ACGTN symbols in reference sequence are allowed
and correctly recognised, however all the other symbols (e.g., extended IUPAC
symbols, MRSVWYHKDB) within sequences are converted to N.</p>
<p>As a reference sequence, the function expects either location of
(preferably `bgzip`ped) FASTA file or an object obtained by
<code><a href="preprocessGenome.html">preprocessGenome</a></code>. The latter is preferred if methylation
calling is performed on multiple BAM files.</p>
<p>The alignment records of the output BAM file will contain additional XM tag
with the methylation
call string for every mapped read which did not have XM tag available.
Besides that, XG tag with reference sequence strand ("CT" or "GA") is added
to such reads in case it wasn't present.</p>
<p>Please note that for the purpose of methylation calling, the very same
reference genome must be used for both alignment (when BAM is produced) and
calling cytosine methylation by <code>callMethylation</code> method.
Exception is thrown if reference sequence header of BAM file doesn't match
reference sequence data provided (this matching is performed on the basis
of names and lengths of reference sequences).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="preprocessGenome.html">preprocessGenome</a></code> for preloading reference sequences
and `epialleleR` vignettes for the description of usage and sample data.</p>
<p><a href="https://www.bioinformatics.babraham.ac.uk/projects/bismark/" class="external-link">Bismark</a> Bisulfite Read Mapper and Methylation Caller,
<a href="https://arxiv.org/abs/1401.1129" class="external-link">bwa-meth</a> for fast and accurate alignment of long bisulfite-seq reads,
or info on <a href="https://support-docs.illumina.com/SW/dragen_v42/Content/SW/DRAGEN/MPipelineMeth_fDG.htm" class="external-link">Illumina DRAGEN Bio IT Platform</a>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="fu">callMethylation</span><span class="op">(</span></span></span>
<span class="r-in"><span>    input.bam.file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test"</span>, <span class="st">"dragen-se-unsort-xg.bam"</span>, package<span class="op">=</span><span class="st">"epialleleR"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    output.bam.file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"output-"</span>, fileext<span class="op">=</span><span class="st">".bam"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    genome<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test"</span>, <span class="st">"reference.fasta.gz"</span>, package<span class="op">=</span><span class="st">"epialleleR"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading reference genome file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.001s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Making methylation calls </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.023s]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $nrecs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ncalled</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Oleksii Nikolaienko.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

