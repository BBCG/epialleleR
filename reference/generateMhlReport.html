<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>generateMhlReport — generateMhlReport • epialleleR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="generateMhlReport — generateMhlReport"><meta property="og:description" content="This function computes Linearised Methylated Haplotype Load
(\(lMHL\)) per genomic position."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epialleleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/epialleleR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/values.html">The epialleleR output values</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BBCG/epialleleR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>generateMhlReport</h1>
    <small class="dont-index">Source: <a href="https://github.com/BBCG/epialleleR/blob/HEAD/R/generateMhlReport.R" class="external-link"><code>R/generateMhlReport.R</code></a></small>
    <div class="hidden name"><code>generateMhlReport.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function computes <em>Linearised</em> Methylated Haplotype Load
(\(lMHL\)) per genomic position.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generateMhlReport</span><span class="op">(</span></span>
<span>  <span class="va">bam</span>,</span>
<span>  report.file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  haplotype.context <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CG"</span>, <span class="st">"CHG"</span>, <span class="st">"CHH"</span>, <span class="st">"CxG"</span>, <span class="st">"CX"</span><span class="op">)</span>,</span>
<span>  max.haplotype.window <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  min.haplotype.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  gzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>bam</dt>
<dd><p>BAM file location string OR preprocessed output of
<code><a href="preprocessBam.html">preprocessBam</a></code> function. BAM file alignment records
must contain XG tag (strand information for the reference genome) and
methylation call string (XM tag). Read more about these and other
requirements and BAM preprocessing at <code><a href="preprocessBam.html">preprocessBam</a></code>.</p></dd>


<dt>report.file</dt>
<dd><p>file location string to write the \(lMHL\) report.
If NULL (the default) then report is returned as a
<code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> object.</p></dd>


<dt>haplotype.context</dt>
<dd><p>string for a cytosine context that defines
a haplotype:</p><ul><li><p>"CG" (the default) -- CpG cytosines only (called as zZ)</p></li>
<li><p>"CHG" -- CHG cytosines only (xX)</p></li>
<li><p>"CHH" -- CHH cytosines only (hH)</p></li>
<li><p>"CxG" -- CG and CHG cytosines (zZxX)</p></li>
<li><p>"CX" -- all cytosines; this, as well as the other non-CG contexts,
  may have little sense but still included for consistency</p></li>
</ul><p>If \(lMHL\) calculations are needed for all three possible cytosine
contexts <em>independently</em>, one has to run this function for
each required `haplotype.context` separately, because
`haplotype.context`=="CX" assumes that <em>any</em> cytosine context
is allowed within the same haplotype. This behaviour may change in the
future.</p></dd>


<dt>max.haplotype.window</dt>
<dd><p>non-negative integer for maximum value of
\(L'\) in \(lMHL\) formula.
When 0 (the default), calculations are performed for the full haplotype
length (\(L'=L\), although the maximum value is currently limited to
65535). Having no length restrictions make sense for short-read sequencing
when the
length of the read is comparable to the length of a typical methylated block,
the depth of coverage is high, and the lengths of all reads are roughly
equal.
However, calculations using non-restricted haplotype length are meaningless
for long-read sequencing --- when the same read may
cover a number of regions with very different methylation properties, and
reads themselves can be of a very different length. In the latter case it is
advised to limit the `max.haplotype.window` to a number of cytosines in a
typical hypermethylated region. For thorough
explanation and more examples, see Details section and vignette.</p></dd>


<dt>min.haplotype.length</dt>
<dd><p>non-negative integer for minimum length of a
haplotype (default: 0 will include haplotypes of any length).
When `min.haplotype.length`&gt;0, reads
(read pairs) with fewer than `min.haplotype.length` cytosines
within the `haplotype.context` are skipped.</p></dd>


<dt>...</dt>
<dd><p>other parameters to pass to the
<code><a href="preprocessBam.html">preprocessBam</a></code> function.
Options have no effect if preprocessed BAM data was supplied as an input.</p></dd>


<dt>gzip</dt>
<dd><p>boolean to compress the report (default: FALSE).</p></dd>


<dt>verbose</dt>
<dd><p>boolean to report progress and timings (default: TRUE).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> object containing \(lMHL\)</p>


<p>report or NULL if report.file was specified. The
report columns are:</p><ul><li><p>rname -- reference sequence name (as in BAM)</p></li>
<li><p>strand -- strand</p></li>
<li><p>pos -- cytosine position</p></li>
<li><p>context -- methylation context</p></li>
<li><p>coverage -- number of reads (read pairs) that include this position</p></li>
<li><p>length -- average length of a haplotype, i.e.,
  average number of cytosines within `haplotype.context` for
  reads (read pairs) that include this position</p></li>
<li><p>lmhl -- \(lMHL\) value</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function reports <em>Linearised</em> Methylated Haplotype Load
(\(lMHL\)) at the level of individual cytosines using BAM file location
or preprocessed data as an input. Function uses the following formula:</p>
<p>$$lMHL=\frac{\sum_{i=1}^{L'} w_{i} \times MH_{i}}{\sum_{i=1}^{L'} w_{i} \times H_{i}}$$</p>
<p>where \(L'\) is the length of a calculation window
(e.g., number of CpGs; \(L' \le L\),
where \(L\) is the length of a haplotype covering current genomic
position),
\(MH_{i}\) is a number of fully successive methylated stretches
with \(i\) loci within a methylated stretch that overlaps
current genomic position,
\(H_{i}\) is a number of fully successive stretches with \(i\) loci,
\(w_{i}\) is a weight for \(i\)-locus haplotype (\(w_{i}=i\)).</p>
<p>This formula is a modification of the original 
Methylated Haplotype Load (MHL) formula that was 
first described by Guo et al., 2017
(doi: <a href="https://doi.org/10.1038/ng.3805" class="external-link">10.1038/ng.3805</a>):</p>
<p>$$MHL=\frac{\sum_{i=1}^{L} w_{i} \times \frac{MH_{i}}{H_{i}}}{\sum_{i=1}^{L} w_{i}}$$</p>
<p>where \(L\) is the length of a longest haplotype covering current genomic
position, \(\frac{MH_{i}}{H_{i}}=P(MH_{i})\) is the fraction
of fully successive methylated stretches with \(i\) loci, \(w_{i}\) is
a weight for \(i\)-locus haplotype (\(w_{i}=i\)).</p>
<p>The modifications to original formula are made in order to:</p><ul><li><p><b>provide granularity of values</b> --- the original MHL
  formula gives the same MHL value for every cytosine of a partially
  methylated haplotype (e.g., MHL=0.358 for each cytosine within a read with
  methylation call string "zZZZ"). In contrast, \(lMHL\)==0 for the
  non-methylated cytosines (e.g., \(lMHL\)==c(0, 0.5, 0.5, 0.5) for
  cytosines within a read with methylation call string "zZZZ").</p></li>
<li><p><b>enable calculations for long-read sequencing alignments</b> ---
  \(lMHL\)
  calculation window can be limited to a particular number of cytosines.
  This allows to use the formula for very long haplotypes as well as
  to compare values for sequencing data of varying read length.</p></li>
<li><p><b>reduce the complexity of MHL calculation</b> for data of high
  breadth and depth --- \(lMHL\) values for all genomic positions can be
  calculated using a single pass (cycling through reads just once) as
  the linearised calculations of numerator and denominator for
  \(lMHL\) do not require prior knowledge on how many reads cover
  a particular position. This is achieved by moving \(H_{i}\) multiplier
  to the denominator of the \(lMHL\) formula.</p></li>
</ul><p>These modifications make \(lMHL\) calculation similar though
<em>non-equivalent</em> to the original MHL.
However, the most important property of MHL --- emphasis on
hypermethylated blocks --- is retained. And in return, \(lMHL\) gets better
applicability for analysis of sequencing data of varying depth and read
length.</p>
<p>Other notes on function's behaviour:</p>
<p>Methylation string bases in unknown context ("uU") are simply ignored, which,
to the best of our knowledge, is consistent with the behaviour of other
tools.</p>
<p>Cytosine context present in more than 50% of the reads is assumed
to be correct, while all bases at the same position but having other
methylation context are simply ignored. This allows reports to be prepared
without using the reference genome sequence.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>`values` vignette for a comparison and visualisation of epialleleR
output values for various input files. `epialleleR` vignette for the
description of usage and sample data.</p>
<p><code><a href="preprocessBam.html">preprocessBam</a></code> for preloading BAM data,
<code><a href="generateCytosineReport.html">generateCytosineReport</a></code> for other methylation statistics at the
level of individual cytosines,
<code><a href="generateBedReport.html">generateBedReport</a></code> for genomic region-based statistics,
<code><a href="generateVcfReport.html">generateVcfReport</a></code> for evaluating epiallele-SNV associations,
<code><a href="extractPatterns.html">extractPatterns</a></code> for exploring methylation patterns,
<code><a href="generateBedEcdf.html">generateBedEcdf</a></code> for analysing the distribution of per-read
beta values.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="va">capture.bam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"capture.bam"</span>, package<span class="op">=</span><span class="st">"epialleleR"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># lMHL report</span></span></span>
<span class="r-in"><span>  <span class="va">mhl.report</span> <span class="op">&lt;-</span> <span class="fu">generateMhlReport</span><span class="op">(</span><span class="va">capture.bam</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.017s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing lMHL report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.048s]</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># lMHL report with a `max.haplotype.window` of 1 is identical to a</span></span></span>
<span class="r-in"><span>  <span class="co"># conventional cytosine report (or nearly identical when sequencing errors</span></span></span>
<span class="r-in"><span>  <span class="co"># are present)</span></span></span>
<span class="r-in"><span>  <span class="va">mhl.report</span> <span class="op">&lt;-</span> <span class="fu">generateMhlReport</span><span class="op">(</span><span class="va">capture.bam</span>, max.haplotype.window<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.016s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing lMHL report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.048s]</span>
<span class="r-in"><span>  <span class="va">cg.report</span>  <span class="op">&lt;-</span> <span class="fu"><a href="generateCytosineReport.html">generateCytosineReport</a></span><span class="op">(</span><span class="va">capture.bam</span>, threshold.reads<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.017s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing cytosine report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.026s]</span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mhl.report</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">rname</span>, <span class="va">strand</span>, <span class="va">pos</span>, <span class="va">context</span>, value<span class="op">=</span><span class="va">lmhl</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="va">cg.report</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span><span class="va">rname</span>, <span class="va">strand</span>, <span class="va">pos</span>, <span class="va">context</span>, value<span class="op">=</span><span class="va">meth</span><span class="op">/</span><span class="op">(</span><span class="va">meth</span><span class="op">+</span><span class="va">unmeth</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Oleksii Nikolaienko.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

