<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>generateMhlReport — generateMhlReport • epialleleR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="generateMhlReport — generateMhlReport"><meta name="description" content="This function computes Linearised Methylated Haplotype Load
(\(lMHL\)) per genomic position."><meta property="og:description" content="This function computes Linearised Methylated Haplotype Load
(\(lMHL\)) per genomic position."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epialleleR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.13.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epialleleR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/values.html">The epialleleR output values &lt;img style="float: right;" src="epialleleR_logo.svg"&gt; </a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BBCG/epialleleR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>generateMhlReport</h1>
      <small class="dont-index">Source: <a href="https://github.com/BBCG/epialleleR/blob/devel/R/generateMhlReport.R" class="external-link"><code>R/generateMhlReport.R</code></a></small>
      <div class="d-none name"><code>generateMhlReport.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes <em>Linearised</em> Methylated Haplotype Load
(\(lMHL\)) per genomic position.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">generateMhlReport</span><span class="op">(</span></span>
<span>  <span class="va">bam</span>,</span>
<span>  report.file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  haplotype.context <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CG"</span>, <span class="st">"CHG"</span>, <span class="st">"CHH"</span>, <span class="st">"CxG"</span>, <span class="st">"CX"</span><span class="op">)</span>,</span>
<span>  max.haplotype.window <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  min.haplotype.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max.outofcontext.beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  gzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-bam">bam<a class="anchor" aria-label="anchor" href="#arg-bam"></a></dt>
<dd><p>BAM file location string OR preprocessed output of
<code><a href="preprocessBam.html">preprocessBam</a></code> function. Read more about BAM file
requirements and BAM preprocessing at <code><a href="preprocessBam.html">preprocessBam</a></code>.</p></dd>


<dt id="arg-report-file">report.file<a class="anchor" aria-label="anchor" href="#arg-report-file"></a></dt>
<dd><p>file location string to write the \(lMHL\) report.
If NULL (the default) then report is returned as a
<code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> object.</p></dd>


<dt id="arg-haplotype-context">haplotype.context<a class="anchor" aria-label="anchor" href="#arg-haplotype-context"></a></dt>
<dd><p>string for a cytosine context that defines
a haplotype:</p><ul><li><p>"CG" (the default) – CpG cytosines only (called as zZ)</p></li>
<li><p>"CHG" – CHG cytosines only (xX)</p></li>
<li><p>"CHH" – CHH cytosines only (hH)</p></li>
<li><p>"CxG" – CG and CHG cytosines (zZxX)</p></li>
<li><p>"CX" – all cytosines; this, as well as the other non-CG contexts,
  may have little sense but still included for consistency</p></li>
</ul><p>If \(lMHL\) calculations are needed for all three possible cytosine
contexts <em>independently</em>, one has to run this function for
each required `haplotype.context` separately, because
`haplotype.context`=="CX" assumes that <em>any</em> cytosine context
is allowed within the same haplotype. This behaviour may change in the
future.</p></dd>


<dt id="arg-max-haplotype-window">max.haplotype.window<a class="anchor" aria-label="anchor" href="#arg-max-haplotype-window"></a></dt>
<dd><p>non-negative integer for maximum value of
\(L'\) in \(lMHL\) formula.
When 0 (the default), calculations are performed for the full haplotype
length (\(L'=L\), although the maximum value is currently limited to
65535). Having no length restrictions make sense for short-read sequencing
when the
length of the read is comparable to the length of a typical methylated block,
the depth of coverage is high, and the lengths of all reads are roughly
equal.
However, calculations using non-restricted haplotype length are meaningless
for long-read sequencing — when the same read may
cover a number of regions with very different methylation properties, and
reads themselves can be of a very different length. In the latter case it is
advised to limit the `max.haplotype.window` to a number of cytosines in a
typical hypermethylated region. For thorough
explanation and more examples, see Details section and vignette.</p></dd>


<dt id="arg-min-haplotype-length">min.haplotype.length<a class="anchor" aria-label="anchor" href="#arg-min-haplotype-length"></a></dt>
<dd><p>non-negative integer for minimum length of a
haplotype (default: 0 will include haplotypes of any length).
When `min.haplotype.length`&gt;0, reads
(read pairs) with fewer than `min.haplotype.length` cytosines
within the `haplotype.context` are skipped.</p></dd>


<dt id="arg-max-outofcontext-beta">max.outofcontext.beta<a class="anchor" aria-label="anchor" href="#arg-max-outofcontext-beta"></a></dt>
<dd><p>real number in the range [0;1] (default: 0.1).
Reads (read pairs) with average beta value for out-of-context cytosines
<strong>above</strong> this threshold are skipped. Set to 1 to disable filtering.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other parameters to pass to the
<code><a href="preprocessBam.html">preprocessBam</a></code> function.
Options have no effect if preprocessed BAM data was supplied as an input.</p></dd>


<dt id="arg-gzip">gzip<a class="anchor" aria-label="anchor" href="#arg-gzip"></a></dt>
<dd><p>boolean to compress the report (default: FALSE).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>boolean to report progress and timings (default: TRUE).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> object containing \(lMHL\)
report or NULL if report.file was specified. The
report columns are:</p><ul><li><p>rname – reference sequence name (as in BAM)</p></li>
<li><p>strand – strand</p></li>
<li><p>pos – cytosine position</p></li>
<li><p>context – methylation context</p></li>
<li><p>coverage – number of reads (read pairs) that include this position</p></li>
<li><p>length – average length of a haplotype, i.e.,
  average number of cytosines within `haplotype.context` for
  reads (read pairs) that include this position</p></li>
<li><p>lmhl – \(lMHL\) value</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function reports <em>Linearised</em> Methylated Haplotype Load
(\(lMHL\)) at the level of individual cytosines using BAM file location
or preprocessed data as an input. Function uses the following formula:</p>
<p>$$lMHL=\frac{\sum_{i=1}^{L'} w_{i} \times MH_{i}}{\sum_{i=1}^{L'} w_{i} \times H_{i}}$$</p>
<p>where \(L'\) is the length of a calculation window
(e.g., number of CpGs; \(L' \le L\),
where \(L\) is the length of a haplotype covering current genomic
position),
\(MH_{i}\) is a number of fully successive methylated stretches
with \(i\) loci within a methylated stretch that overlaps
current genomic position,
\(H_{i}\) is a number of fully successive stretches with \(i\) loci,
\(w_{i}\) is a weight for \(i\)-locus haplotype (\(w_{i}=i\)).</p>
<p>This formula is a modification of the original
Methylated Haplotype Load (MHL) formula that was
first described by Guo et al., 2017
(doi: <a href="https://doi.org/10.1038/ng.3805" class="external-link">10.1038/ng.3805</a>):</p>
<p>$$MHL=\frac{\sum_{i=1}^{L} w_{i} \times \frac{MH_{i}}{H_{i}}}{\sum_{i=1}^{L} w_{i}}$$</p>
<p>where \(L\) is the length of a longest haplotype covering current genomic
position, \(\frac{MH_{i}}{H_{i}}=P(MH_{i})\) is the fraction
of fully successive methylated stretches with \(i\) loci, \(w_{i}\) is
a weight for \(i\)-locus haplotype (\(w_{i}=i\)).</p>
<p>The modifications to original formula are made in order to:</p><ul><li><p><b>provide granularity of values</b> — the original MHL
  formula gives the same MHL value for every cytosine of a partially
  methylated haplotype (e.g., MHL=0.358 for each cytosine within a read with
  methylation call string "zZZZ"). In contrast, \(lMHL\)==0 for the
  non-methylated cytosines (e.g., \(lMHL\)==c(0, 0.5, 0.5, 0.5) for
  cytosines within a read with methylation call string "zZZZ").</p></li>
<li><p><b>enable calculations for long-read sequencing alignments</b> —
  \(lMHL\)
  calculation window can be limited to a particular number of cytosines.
  This allows to use the formula for very long haplotypes as well as
  to compare values for sequencing data of varying read length.</p></li>
<li><p><b>reduce the complexity of MHL calculation</b> for data of high
  breadth and depth — \(lMHL\) values for all genomic positions can be
  calculated using a single pass (cycling through reads just once) as
  the linearised calculations of numerator and denominator for
  \(lMHL\) do not require prior knowledge on how many reads cover
  a particular position. This is achieved by moving \(H_{i}\) multiplier
  to the denominator of the \(lMHL\) formula.</p></li>
</ul><p>These modifications make \(lMHL\) calculation similar though
<em>non-equivalent</em> to the original MHL.
However, the most important property of MHL — emphasis on
hypermethylated blocks — is retained. And in return, \(lMHL\) gets better
applicability for analysis of sequencing data of varying depth and read
length.</p>
<p>Other notes on function's behaviour:</p>
<p>Methylation string bases in unknown context ("uU") are simply ignored, which,
to the best of our knowledge, is consistent with the behaviour of other
tools.</p>
<p>Cytosine context present in more than 50% of the reads is assumed
to be correct, while all bases at the same position but having other
methylation context are simply ignored. This allows reports to be prepared
without using the reference genome sequence.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>`values` vignette for a comparison and visualisation of epialleleR
output values for various input files. `epialleleR` vignette for the
description of usage and sample data.</p>
<p><code><a href="preprocessBam.html">preprocessBam</a></code> for preloading BAM data,
<code><a href="generateCytosineReport.html">generateCytosineReport</a></code> for other methylation statistics at the
level of individual cytosines,
<code><a href="generateBedReport.html">generateBedReport</a></code> for genomic region-based statistics,
<code><a href="generateVcfReport.html">generateVcfReport</a></code> for evaluating epiallele-SNV associations,
<code><a href="extractPatterns.html">extractPatterns</a></code> for exploring methylation patterns
and <code><a href="plotPatterns.html">plotPatterns</a></code> for pretty plotting of its output,
<code><a href="generateBedEcdf.html">generateBedEcdf</a></code> for analysing the distribution of per-read
beta values.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="va">capture.bam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"capture.bam"</span>, package<span class="op">=</span><span class="st">"epialleleR"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># lMHL report</span></span></span>
<span class="r-in"><span>  <span class="va">mhl.report</span> <span class="op">&lt;-</span> <span class="fu">generateMhlReport</span><span class="op">(</span><span class="va">capture.bam</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> short-read, paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.012s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing lMHL report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.021s]</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># lMHL report with a `max.haplotype.window` of 1 is identical to a</span></span></span>
<span class="r-in"><span>  <span class="co"># conventional cytosine report (or nearly identical when sequencing errors</span></span></span>
<span class="r-in"><span>  <span class="co"># are present)</span></span></span>
<span class="r-in"><span>  <span class="va">mhl.report</span> <span class="op">&lt;-</span> <span class="fu">generateMhlReport</span><span class="op">(</span><span class="va">capture.bam</span>, max.haplotype.window<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> short-read, paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.012s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing lMHL report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.023s]</span>
<span class="r-in"><span>  <span class="va">cg.report</span>  <span class="op">&lt;-</span> <span class="fu"><a href="generateCytosineReport.html">generateCytosineReport</a></span><span class="op">(</span><span class="va">capture.bam</span>, threshold.reads<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking BAM file: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> short-read, paired-end, name-sorted alignment detected</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Reading paired-end BAM file </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.012s]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Preparing cytosine report </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> [0.013s]</span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">mhl.report</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">rname</span>, <span class="va">strand</span>, <span class="va">pos</span>, <span class="va">context</span>, value<span class="op">=</span><span class="va">lmhl</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    <span class="va">cg.report</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span><span class="va">rname</span>, <span class="va">strand</span>, <span class="va">pos</span>, <span class="va">context</span>, value<span class="op">=</span><span class="va">meth</span><span class="op">/</span><span class="op">(</span><span class="va">meth</span><span class="op">+</span><span class="va">unmeth</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Oleksii Nikolaienko.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

