<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>generateCytosineReport — generateCytosineReport • epialleleR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="generateCytosineReport — generateCytosineReport" />
<meta property="og:description" content="This function counts methylated and unmethylated DNA bases taking into the
account average methylation level of the entire sequence read." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epialleleR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/epialleleR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/BBCG/epialleleR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>generateCytosineReport</h1>
    <small class="dont-index">Source: <a href='https://github.com/BBCG/epialleleR/blob/master/R/generateCytosineReport.R'><code>R/generateCytosineReport.R</code></a></small>
    <div class="hidden name"><code>generateCytosineReport.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function counts methylated and unmethylated DNA bases taking into the
account average methylation level of the entire sequence read.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>generateCytosineReport</span><span class='op'>(</span>
  <span class='va'>bam</span>,
  report.file <span class='op'>=</span> <span class='cn'>NULL</span>,
  threshold.reads <span class='op'>=</span> <span class='cn'>TRUE</span>,
  threshold.context <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CG"</span>, <span class='st'>"CHG"</span>, <span class='st'>"CHH"</span>, <span class='st'>"CxG"</span>, <span class='st'>"CX"</span><span class='op'>)</span>,
  min.context.sites <span class='op'>=</span> <span class='fl'>2</span>,
  min.context.beta <span class='op'>=</span> <span class='fl'>0.5</span>,
  max.outofcontext.beta <span class='op'>=</span> <span class='fl'>0.1</span>,
  report.context <span class='op'>=</span> <span class='va'>threshold.context</span>,
  min.mapq <span class='op'>=</span> <span class='fl'>0</span>,
  skip.duplicates <span class='op'>=</span> <span class='cn'>FALSE</span>,
  gzip <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>bam</th>
      <td><p>BAM file location string OR preprocessed output of
<code><a href='preprocessBam.html'>preprocessBam</a></code> function.</p></td>
    </tr>
    <tr>
      <th>report.file</th>
      <td><p>file location string to write the cytosine report. If NULL
(the default) then report is returned as a
<code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code> object.</p></td>
    </tr>
    <tr>
      <th>threshold.reads</th>
      <td><p>boolean defining if sequence reads (read pairs) should
be thresholded before counting methylated cytosines (default: TRUE).
Disabling thresholding makes the report virtually indistinguishable from the
ones generated by other software, such as Bismark or Illumina DRAGEN Bio IT
Platform.</p></td>
    </tr>
    <tr>
      <th>threshold.context</th>
      <td><p>string defining cytosine methylation context used
for thresholding the reads:</p><ul>
<li><p>"CG" (the default) -- within-the-context: CpG cytosines (called as
  zZ), out-of-context: all the other cytosines (hHxX)</p></li>
<li><p>"CHG" -- within-the-context: CHG cytosines (xX), out-of-context: hHzZ</p></li>
<li><p>"CHH" -- within-the-context: CHH cytosines (hH), out-of-context: xXzZ</p></li>
<li><p>"CxG" -- within-the-context: CG and CHG cytosines (zZxX),
  out-of-context: CHH cytosines (hH)</p></li>
<li><p>"CX" -- all cytosines are considered within-the-context, this
  effectively results in no thresholding</p></li>
</ul><p>This option has no effect when read thresholding is disabled.</p></td>
    </tr>
    <tr>
      <th>min.context.sites</th>
      <td><p>non-negative integer for minimum number of cytosines
within the `threshold.context` (default: 2). Reads containing <strong>fewer</strong>
within-the-context cytosines are considered completely unmethylated (all C
are counted as T). This option has no effect when read thresholding is
disabled.</p></td>
    </tr>
    <tr>
      <th>min.context.beta</th>
      <td><p>real number in the range [0;1] (default: 0.5). Reads
with average beta value for within-the-context cytosines <strong>below</strong> this
threshold are considered completely unmethylated (all C are counted as T).
This option has no effect when read thresholding is disabled.</p></td>
    </tr>
    <tr>
      <th>max.outofcontext.beta</th>
      <td><p>real number in the range [0;1] (default: 0.1).
Reads with average beta value for out-of-context cytosines <strong>above</strong>
this threshold are considered completely unmethylated (all C are counted as
T). This option has no effect when read thresholding is disabled.</p></td>
    </tr>
    <tr>
      <th>report.context</th>
      <td><p>string defining cytosine methylation context to report
(default: value of `threshold.context`).</p></td>
    </tr>
    <tr>
      <th>min.mapq</th>
      <td><p>non-negative integer threshold for minimum read mapping
quality (default: 0). Option has no effect if preprocessed BAM data was
supplied as an input.</p></td>
    </tr>
    <tr>
      <th>skip.duplicates</th>
      <td><p>boolean defining if duplicate aligned reads should be
skipped (default: FALSE). Option has no effect if preprocessed BAM data was
supplied as an input OR duplicate reads were not marked by alignment
software.</p></td>
    </tr>
    <tr>
      <th>gzip</th>
      <td><p>boolean to compress the report (default: FALSE).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>boolean to report progress and timings (default: TRUE).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></code> object containing cytosine
report in Bismark format or NULL if report.file was specified. The report
columns are:</p><ul>
<li><p>rname -- reference sequence name (as in BAM)</p></li>
<li><p>strand -- strand</p></li>
<li><p>pos -- cytosine position</p></li>
<li><p>context -- methylation context</p></li>
<li><p>meth -- number of methylated cytosines</p></li>
<li><p>unmeth -- number of unmethylated cytosines</p></li>
<li><p>triad -- sequence spanning region [&lt;pos&gt;:&lt;pos+2&gt;]. Always equals to
  "NNN" due to the reference genome-independent reporting</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function reports cytosine methylation information using BAM file as an
input. In contrast to the other currently available software, reads (or read
pairs as a single entity) can be thresholded by their average methylation
level before counting methylated bases, effectively resulting in
hypermethylated variant epiallele frequency (VEF) being reported instead of
beta value. The function's logic is explained below.</p>
<p>Let's suppose we have a BAM file with four reads, all mapped to the "+"
strand of chromosome 1, positions 1-16. Assuming the default values
for the thresholding parameters (threshold.reads = TRUE,
threshold.context = "CG", min.context.sites = 2, min.context.beta = 0.5,
max.outofcontext.beta = 0.1), the input and results will look as following:</p>
<table class='table'>
<tr><td>methylation string</td><td>threshold</td><td>explained</td><td>methylation reported</td></tr>
<tr><td>...Z..x+.h..x..h.</td><td>below</td><td>min.context.sites &lt; 2 (only one zZ base)</td><td>all cytosines unmethylated</td></tr>
<tr><td>...Z..z.h..x..h.</td><td>above</td><td>pass all criteria</td><td>only C4 is methylated</td></tr>
<tr><td>...Z..z.h..X..h.</td><td>below</td><td>max.outofcontext.beta &gt; 0.1 (1XH / 3xXhH = 0.33)</td><td>all cytosines unmethylated</td></tr>
<tr><td>...Z..z.h..z-.h.</td><td>below</td><td>min.context.beta &lt; 0.5 (1Z / 3zZ = 0.33)</td><td>all cytosines unmethylated</td></tr>
</table>


<p>Only the second read will satisfy all of the thresholding criteria, leading
to the following CX report (given that all reads map to chr1:+:1-16):</p>
<table class='table'>
<tr><td>rname</td><td>strand</td><td>pos</td><td>context</td><td>meth</td><td>unmeth</td><td>triad</td></tr>
<tr><td>chr1</td><td>+</td><td>4</td><td>CG</td><td>1</td><td>3</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>7</td><td>CG</td><td>0</td><td>3</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>9</td><td>CHH</td><td>0</td><td>4</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>12</td><td>CHG</td><td>0</td><td>3</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>15</td><td>CHH</td><td>0</td><td>4</td><td>NNN</td></tr>
</table>


<p>With the thresholding disabled (threshold.reads = FALSE) all methylated bases
will retain their status, so the CX report will be similar to the reports
produced by other methylation callers (such as Bismark or Illumina DRAGEN Bio
IT Platform):</p>
<table class='table'>
<tr><td>rname</td><td>strand</td><td>pos</td><td>context</td><td>meth</td><td>unmeth</td><td>triad</td></tr>
<tr><td>chr1</td><td>+</td><td>4</td><td>CG</td><td>4</td><td>0</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>7</td><td>CG</td><td>0</td><td>3</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>9</td><td>CHH</td><td>0</td><td>4</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>12</td><td>CHG</td><td>1</td><td>2</td><td>NNN</td></tr>
<tr><td>chr1</td><td>+</td><td>15</td><td>CHH</td><td>0</td><td>4</td><td>NNN</td></tr>
</table>


<p>Other notes:</p>
<p>Methylation string bases in unknown context ("uU") are simply ignored, which,
to the best of our knowledge, is consistent with the behaviour of other
tools.</p>
<p>In order to mitigate sequencing errors (leading to rare variations in the
methylation context, as in reads 1 and 4 above), the context present in more
than 50% of the reads is assumed to be correct, while all bases at the same
position but having other methylation context are simply ignored. This allows
reports to be prepared without using the reference genome sequence.</p>
<p>The downside of not using the reference genome sequence is the inability to
determine the actual sequence of triplet for every base in the cytosine 
report. For now the sequence is reported as "NNN" and this will stay until
such information will be considered as worth adding.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='preprocessBam.html'>preprocessBam</a></code> for preloading BAM data,
<code><a href='generateBedReport.html'>generateBedReport</a></code> for genomic region-based statistics,
<code><a href='generateVcfReport.html'>generateVcfReport</a></code> for evaluating epiallele-SNV associations,
<code><a href='generateBedEcdf.html'>generateBedEcdf</a></code> for analysing the distribution of per-read
beta values, and `epialleleR` vignettes for the description of usage and
sample data.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'>  <span class='va'>capture.bam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"capture.bam"</span>, package<span class='op'>=</span><span class='st'>"epialleleR"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># CpG report with thresholding</span></span>
<span class='r-in'>  <span class='va'>cg.report</span> <span class='op'>&lt;-</span> <span class='fu'>generateCytosineReport</span><span class='op'>(</span><span class='va'>capture.bam</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading BAM file</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.158s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Preprocessing BAM data:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Transforming sequences</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.016s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Merging pairs</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.014s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Thresholding reads</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.002s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Preparing cytosine report</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.021s]</span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># CX report without thresholding</span></span>
<span class='r-in'>  <span class='va'>cx.report</span> <span class='op'>&lt;-</span> <span class='fu'>generateCytosineReport</span><span class='op'>(</span><span class='va'>capture.bam</span>, threshold.reads<span class='op'>=</span><span class='cn'>FALSE</span>,</span>
<span class='r-in'>               report.context<span class='op'>=</span><span class='st'>"CX"</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Reading BAM file</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.157s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Preprocessing BAM data:</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Transforming sequences</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.016s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>   Merging pairs</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.014s]</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Preparing cytosine report</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span>  [0.034s]</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Oleksii Nikolaienko.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


